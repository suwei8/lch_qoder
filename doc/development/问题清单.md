# 洗车IOT管理系统 E2E测试问题清单

## 🚨 严重级别分类

### 🔴 阻塞级问题 (Blocker)
*严重影响测试执行，必须立即解决*

#### B001: Node.js运行环境缺失
- **问题描述**: 系统中未安装Node.js或未正确配置环境变量
- **影响范围**: 无法启动任何前后端服务，完全阻塞E2E测试
- **复现步骤**:
  1. 打开命令行执行 `node --version`
  2. 系统提示 "命令未找到" 或无响应
  3. 执行 `npm --version` 同样失败
- **错误现象**: 
  ```
  $ node --version
  (无输出)
  
  $ npm --version  
  (无输出)
  ```
- **解决方案**:
  ```bash
  # 方案1: 官网下载安装
  1. 访问 https://nodejs.org/zh-cn/download/
  2. 下载Windows安装包 (推荐LTS版本)
  3. 运行安装程序，确保添加到PATH
  4. 重启命令行验证: node --version
  
  # 方案2: 使用包管理器
  winget install OpenJS.NodeJS
  # 或
  choco install nodejs
  ```
- **验证方法**: `node --version` 和 `npm --version` 都能正常输出版本号
- **优先级**: 🔴 最高
- **估计修复时间**: 15分钟

#### B002: 数据库服务未启动
- **问题描述**: MySQL(3307)和Redis(6380)服务未运行
- **影响范围**: 后端API无法连接数据库，所有涉及数据的测试失败
- **复现步骤**:
  1. 执行 `netstat -an | findstr "3307"`
  2. 执行 `netstat -an | findstr "6380"`
  3. 两个端口均无监听状态
- **错误现象**:
  ```
  $ netstat -an | findstr "3307"
  (无输出 - 端口未监听)
  
  $ netstat -an | findstr "6380"  
  (无输出 - 端口未监听)
  ```
- **解决方案**:
  ```bash
  # 方案1: Docker启动 (推荐)
  docker compose -f docker-compose.db.yml up -d
  
  # 方案2: 本机服务启动
  # MySQL: 启动MySQL服务，配置端口3307
  # Redis: 启动Redis服务，配置端口6380
  
  # 方案3: 使用标准端口
  # 修改配置文件使用3306和6379端口
  ```
- **验证方法**: 端口监听检查和连接测试通过
- **优先级**: 🔴 最高  
- **估计修复时间**: 10分钟

---

### 🟠 高级问题 (Critical)
*显著影响测试功能，需要优先解决*

#### C001: 项目依赖包缺失
- **问题描述**: 各模块的node_modules目录不存在，依赖包未安装
- **影响范围**: 即使有Node.js环境也无法启动服务
- **复现步骤**:
  1. 检查 `lch-backend/node_modules` 目录 - 不存在
  2. 检查 `lch-platform/node_modules` 目录 - 不存在  
  3. 检查 `lch-user-h5/node_modules` 目录 - 不存在
- **解决方案**:
  ```bash
  # 安装后端依赖
  cd lch-backend
  npm ci
  
  # 安装平台端依赖
  cd ../lch-platform  
  npm ci
  
  # 安装用户H5端依赖
  cd ../lch-user-h5
  npm ci
  
  # 安装测试依赖
  cd ..
  npm install --save-dev @playwright/test
  npx playwright install
  ```
- **验证方法**: 各目录下存在node_modules且npm start可正常执行
- **优先级**: 🟠 高
- **估计修复时间**: 20分钟

#### C002: 环境配置端口不匹配
- **问题描述**: 项目脚本配置的端口与测试要求不完全一致
- **影响范围**: 可能导致服务启动在错误端口，测试连接失败
- **详细说明**:
  - `start-local-native.bat` 配置: MySQL 3306, Redis 6379
  - 测试要求: MySQL 3307, Redis 6380
  - 后端配置已更新为正确端口，但启动脚本可能不一致
- **解决方案**:
  ```bash
  # 更新启动脚本中的端口配置
  # 或统一使用标准端口 (3306/6379)
  # 或确保所有配置文件端口一致
  ```
- **优先级**: 🟠 高
- **估计修复时间**: 5分钟

---

### 🟡 中级问题 (Major)
*影响部分功能，建议解决*

#### M001: Docker环境未配置
- **问题描述**: docker/docker-compose命令不可用
- **影响范围**: 无法使用推荐的Docker方式启动数据库
- **复现步骤**:
  1. 执行 `docker --version` - 命令未找到
  2. 执行 `docker-compose --version` - 命令未找到
- **解决方案**:
  ```bash
  # 安装Docker Desktop for Windows
  # 或使用本机安装的MySQL/Redis服务
  ```
- **优先级**: 🟡 中等
- **估计修复时间**: 30分钟

#### M002: 测试数据未初始化
- **问题描述**: 数据库中可能缺少测试所需的基础数据
- **影响范围**: 登录测试和数据相关测试可能失败
- **解决方案**:
  ```bash
  # 执行数据库初始化脚本
  init-local-database.bat
  # 或
  create-all-test-data.bat
  ```
- **优先级**: 🟡 中等
- **估计修复时间**: 10分钟

---

### 🟢 低级问题 (Minor)
*不影响核心功能，可选择性解决*

#### L001: TypeScript配置错误已修复 ✅
- **问题描述**: Playwright配置文件中有TypeScript类型错误
- **影响范围**: IDE中显示红色错误线，但不影响实际运行
- **已修复内容**:
  - ✅ 更新`package.json`添加必要依赖声明
  - ✅ 修复`playwright.config.ts`使用兼容性写法
  - ✅ 优化`tsconfig.json`配置选项
  - ✅ 创建`TYPESCRIPT_ERROR_FIX.md`解决指南
- **验证结果**: ✅ 所有TypeScript错误已清除
- **优先级**: ✅ 已完成

#### L002: 测试覆盖可以更全面
- **问题描述**: 当前测试用例主要覆盖基础功能，可扩展更多业务场景
- **改进建议**:
  - 添加支付流程测试
  - 添加设备控制测试  
  - 添加数据导出测试
  - 添加权限边界测试
- **优先级**: 🟢 低
- **估计修复时间**: 数小时

#### L002: 性能测试缺失
- **问题描述**: 当前只有功能测试，缺少性能和压力测试
- **改进建议**:
  - 添加API响应时间监控
  - 添加并发用户测试
  - 添加内存和CPU使用监控
- **优先级**: 🟢 低
- **估计修复时间**: 数小时

---

## 🛠️ 问题解决优先级建议

### 立即解决 (必须)
1. **B001: 安装Node.js环境** - 15分钟
2. **B002: 启动数据库服务** - 10分钟
3. **C001: 安装项目依赖** - 20分钟

### 优先解决 (推荐)  
4. **C002: 统一端口配置** - 5分钟
5. **M002: 初始化测试数据** - 10分钟

### 可选解决
6. **M001: 配置Docker环境** - 30分钟
7. **L001, L002: 扩展测试覆盖** - 数小时

## 📋 快速修复检查单

```bash
# Step 1: 验证Node.js (必须)
□ node --version 输出版本号
□ npm --version 输出版本号

# Step 2: 启动数据库 (必须)  
□ netstat -an | findstr "3307" 有输出
□ netstat -an | findstr "6380" 有输出

# Step 3: 安装依赖 (必须)
□ lch-backend/node_modules 存在
□ lch-platform/node_modules 存在  
□ lch-user-h5/node_modules 存在

# Step 4: 验证服务启动
□ 后端: http://127.0.0.1:5603/api 可访问
□ 平台端: http://127.0.0.1:5601 可访问
□ H5端: http://127.0.0.1:5604 可访问

# Step 5: 执行测试
□ npx playwright test 成功运行
□ artifacts/reports/ 生成测试报告
□ 测试通过率 ≥ 90%
```

## 🔄 问题追踪

| 问题ID | 状态 | 发现时间 | 解决时间 | 负责人 | 备注 |
|--------|------|----------|----------|--------|------|
| B001 | 🔴 Open | 2025-01-07 | - | 开发团队 | 阻塞级，优先处理 |
| B002 | 🔴 Open | 2025-01-07 | - | 开发团队 | 阻塞级，优先处理 |
| C001 | 🟠 Open | 2025-01-07 | - | 开发团队 | 依赖B001解决 |
| C002 | 🟠 Open | 2025-01-07 | - | 开发团队 | 配置统一问题 |
| M001 | 🟡 Open | 2025-01-07 | - | DevOps | 可选，提升开发体验 |
| M002 | 🟡 Open | 2025-01-07 | - | 开发团队 | 依赖B002解决 |

---

**问题总数**: 6个 (阻塞级2个，高级2个，中级2个，低级2个)  
**预计总修复时间**: 60-90分钟 (不含可选项)  
**关键路径**: Node.js环境 → 数据库服务 → 依赖安装 → 测试执行

**联系方式**: 如需技术支持，请联系测试工程师或查看项目README.md